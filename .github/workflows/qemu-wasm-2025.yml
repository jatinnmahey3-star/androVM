- name: Configure QEMU for WASM
  run: |
    source $EMSDK_PATH/emsdk_env.sh
    mkdir -p build-wasm
    cd build-wasm
    CONFIGURE_PATH=$(find .. -maxdepth 3 -type f -name configure | head -n 1)
    echo "Found configure at: $CONFIGURE_PATH"
    if [ -z "$CONFIGURE_PATH" ]; then
      echo "‚ùå Could not find configure script"
      exit 1
    fi
    emconfigure "$CONFIGURE_PATH" \
      --target-list=x86_64-softmmu \
      --disable-docs \
      --disable-tools \
      --static \
      --disable-user \
      CFLAGS="-O3 -sALLOW_MEMORY_GROWTH=1 -sMODULARIZE=1 -sEXPORT_ES6=1 -sWASM_BIGINT" \
      LDFLAGS="-sEXPORT_ALL=1 -sENVIRONMENT=web"
